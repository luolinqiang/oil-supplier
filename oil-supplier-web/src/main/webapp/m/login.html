<!DOCTYPE HTML>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="Sat, 01 Dec 2001 00:00:00 GMT">
    <!--[if lt IE 9]>
    <script src="js/common/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 7]>
    <script src="js/common/iepng.js" type="text/javascript"></script>
    <script type="text/javascript">
        EvPNG.fix('div, ul, img, li, input'); //EvPNG.fix('包含透明PNG图片的标签'); 多个标签之间用英文逗号隔开。
    </script>
    <![endif]-->
    <link href="css/zice.style.css" rel="stylesheet" type="text/css"/>
    <link href="css/buttons.css" rel="stylesheet" type="text/css"/>
    <link href="css/icon.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="css/tipsy.css" media="all"/>
    <title></title>
    <style type="text/css">
        html {
            background-image: none;
        }

        label.iPhoneCheckLabelOn span {
            padding-left: 0px
        }

        #versionBar {
            background-color: #212121;
            position: fixed;
            width: 100%;
            height: 35px;
            bottom: 0;
            left: 0;
            text-align: center;
            line-height: 35px;
            z-index: 11;
            -webkit-box-shadow: black 0px 10px 10px -10px inset;
            -moz-box-shadow: black 0px 10px 10px -10px inset;
            box-shadow: black 0px 10px 10px -10px inset;
        }

        .copyright {
            text-align: center;
            font-size: 10px;
            color: #CCC;
        }

        .copyright a {
            color: #A31F1A;
            text-decoration: none
        }

        #login .logo {
            width: 500px;
            height: 51px;
        }
    </style>
</head>
<body>
    <div id="alertMessage"></div>
    <div id="successLogin"></div>
    <div class="text_success" style="display: none">
        <img src="images/loader_green.gif" alt="Please wait"/>
        <span>登陆成功!请稍后....</span>
    </div>
    <div id="login">
        <div class="inner">
            <div class="logo">
                <!--<img src=""/>-->
            </div>
            <div class="formLogin">
                <form name="formLogin" id="formLogin">
                    <div class="tip">
                        <input class="userName" name="userId" type="text" id="userId" value='13671333719' title="用户名"
                               iscookie="true" nullmsg="请输入用户名!"/>
                    </div>
                    <div class="tip">
                        <input class="password" name="password" type="password" value='HUX+7VtHgb0=' id="password" title="密码"
                               nullmsg="请输入密码!"/>
                    </div>
                    <div class="loginButton">
                        <div style="float: right; padding: 3px 0; margin-right: -12px;">
                            <div>
                                <ul class="uibutton-group">
                                    <li>
                                        <a class="uibutton normal" href="javascript:;" id="but_login">登陆</a>
                                    </li>
                                    <li>
                                        <a class="uibutton normal" href="javascript:;" id="forgetpass">重置</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </form>
            </div>
        </div>
        <div class="shadow"></div>
    </div>
    <!--Login div-->
    <div class="clear"></div>
    <div id="versionBar">
        <div class="copyright">
            &copy; 版权所有
            <span class="tip"><a href="#" title="">找油</a> (推荐使用IE8+,谷歌浏览器可以获得更快,更安全的页面响应速度)技术支持:<a
                    href="#" title="">找油</a></span>
        </div>
    </div>
</body>
<script type="text/javascript" src="js/common/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/common/jquery-jrumble.js"></script>
<script type="text/javascript" src="js/common/jquery.tipsy.js"></script>
<script type="text/javascript" src="js/common/iphone.check.js"></script>
<script type="text/javascript">
    $(document).ready(function() {

        onfocus();
        $(".on_off_checkbox").iphoneStyle();
        $('.tip a ').tipsy({
            gravity : 'sw'
        });
        $('#login').show().animate({
            opacity : 1
        }, 2000);
        $('.logo').show().animate({
            opacity : 1,
            top : '32%'
        }, 800, function() {
            $('.logo').show().delay(1200).animate({
                opacity : 1,
                top : '1%'
            }, 300, function() {
                $('.formLogin').animate({
                    opacity : 1,
                    left : '0'
                }, 300);
                $('.userbox').animate({
                    opacity : 0
                }, 200).hide();
            });
        });

    });

    // 重置
    $('#forgetpass').click(function(e) {
        $(":input").each(function() {
            $('#'+this.name).val("");
        });
    });
    // 点击登录
    $('#but_login').click(function(e) {
        submit();
    });
    //回车登录
    $(document).keydown(function(e){
        if(e.keyCode == 13) {
            submit();
        }
    });
    //表单提交
    function submit()
    {
        var submit = true;
        $("input[nullmsg]").each(function() {
            if ($("#" + this.name).val() == "") {
                showError($("#" + this.name).attr("nullmsg"), 500);
                jrumble();
                setTimeout('hideTop()', 3000);
                submit = false;
                return false;
            }
        });
        if (submit) {
            hideTop();
            loading('核实中..', 1);
            setTimeout("unloading()", 2000);
            setTimeout("Login()", 2500);
        }

    }
    //登录处理函数
    function Login() {
        var formData = new Object();
        var data=$(":input").each(function() {
            formData[this.name] =$("#"+this.name ).val();
        });
        $.ajax({
            async : false,
            cache : false,
            type : 'POST',
            url : "/u/login",// 请求的action路径
            data : $('#formLogin').serialize(),
            error : function(XMLHttpRequest, textStatus, errorThrown) {// 请求失败处理函数

            },
            success : function(data) {
                if (0 == data.code) {
                    loginsuccess();
                    var redirect = GetQueryString("redirectUrl");
                    if (0 == redirect.length)  redirect = "/m/index.html";
                    setTimeout("window.location.href='" + redirect + "'", 100);
                } else {
                    showError(data.msg);
                }
            }
        });
    }

    //点击消息关闭提示
    $('#alertMessage').click(function() {
        hideTop();
    });
    //显示错误提示
    function showError(str) {
        $('#alertMessage').addClass('error').html(str).stop(true, true).show().animate({
            opacity : 1,
            right : '0'
        }, 500);

    }
    //验证通过加载动画
    function loginsuccess()
    {
        $("#login").animate({
            opacity : 1,
            top : '49%'
        }, 200, function() {
            $('.userbox').show().animate({
                opacity : 1
            }, 500);
            $("#login").animate({
                opacity : 0,
                top : '60%'
            }, 500, function() {
                $(this).fadeOut(200, function() {
                    $(".text_success").slideDown();
                    $("#successLogin").animate({
                        opacity : 1,
                        height : "200px"
                    }, 1000);
                });
            });
        });
    }
    function showSuccess(str) {
        $('#alertMessage').removeClass('error').html(str).stop(true, true).show().animate({
            opacity : 1,
            right : '0'
        }, 500);
    }

    function onfocus() {
        if ($(window).width() > 480) {
            $('.tip input').tipsy({
                trigger : 'focus',
                gravity : 'w',
                live : true
            });
        } else {
            $('.tip input').tipsy("hide");
        }
    }

    function hideTop() {
        $('#alertMessage').animate({
            opacity : 0,
            right : '-20'
        }, 500, function() {
            $(this).hide();
        });
    }
    //加载信息
    function loading(name, overlay) {
        $('body').append('<div id="overlay"></div><div id="preloader">' + name + '..</div>');
        if (overlay == 1) {
            $('#overlay').css('opacity', 0.1).fadeIn(function() {
                $('#preloader').fadeIn();
            });
            return false;
        }
        $('#preloader').fadeIn();
    }

    function unloading() {
        $('#preloader').fadeOut('fast', function() {
            $('#overlay').fadeOut();
        });
    }
    // 表单晃动
    function jrumble() {
        $('.inner').jrumble({
            x : 4,
            y : 0,
            rotation : 0
        });
        $('.inner').trigger('startRumble');
        setTimeout('$(".inner").trigger("stopRumble")', 500);
    }

    function GetQueryString(name) {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return "";
    }
</script>
</html>
